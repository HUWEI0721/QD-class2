import{u as ne}from"./index-D5g6VmwX.js";import{a as B}from"./index-BfJ1v8kG.js";import{E as v,d as de}from"./elementPlus-CHQYLhPp.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as w,l as h,h as ue,z as M,B as a,R as l,J as t,al as n,A as P,O as d,P as f,I as A,Q as me,a6 as pe}from"./vendor-Kw1AtJDw.js";const fe={class:"profile-view"},_e={class:"profile-info"},ce={class:"avatar-section"},we={class:"basic-info"},ve={class:"username"},ge={class:"role-tag"},be={class:"join-date"},Ve={class:"profile-stats"},ye={class:"stat-item"},Pe={class:"stat-number"},ke={class:"stat-item"},Ce={class:"stat-number"},qe={class:"stat-item"},Ue={class:"stat-number"},xe={class:"quick-actions"},Ee={class:"card-header"},De={key:1,class:"edit-actions"},Re={class:"activity-timeline"},he={class:"timeline-content"},Me={class:"dialog-footer"},ze={__name:"ProfileView",setup(Fe){const b=ne(),V=w(!1),U=w(!1),y=w(!1),x=w(!1),E=w(),D=w(),p=w({}),s=h({full_name:"",student_id:"",email:"",phone:"",qq:"",wechat:"",dormitory:"",hometown:"",bio:""}),m=h({currentPassword:"",newPassword:"",confirmPassword:""}),R=h({activities:5,photos:12,comments:8}),j=w([]),I={full_name:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},T={currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度至少为6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(r,e,k)=>{e!==m.newPassword?k(new Error("两次输入的密码不一致")):k()},trigger:"blur"}]},z=r=>de(r).format("YYYY年MM月DD日"),Y=r=>({admin:"danger",teacher:"warning",student:"primary"})[r]||"info",L=r=>({admin:"管理员",teacher:"教师",student:"学生"})[r]||"未知",N=()=>{V.value=!0,Object.keys(s).forEach(r=>{s[r]=p.value[r]||""})},O=()=>{V.value=!1,Object.keys(s).forEach(r=>{s[r]=""})},Q=async()=>{E.value&&await E.value.validate(async r=>{if(r){U.value=!0;try{const e=await B.users.updateProfile(s);p.value=e.data,b.user=e.data,V.value=!1,v.success("个人资料更新成功")}catch(e){console.error("更新失败:",e),v.error("更新失败，请重试")}finally{U.value=!1}}})},J=()=>{v.info("头像上传功能开发中...")},$=()=>{m.currentPassword="",m.newPassword="",m.confirmPassword="",y.value=!0},G=async()=>{D.value&&await D.value.validate(async r=>{if(r){x.value=!0;try{await new Promise(e=>setTimeout(e,1e3)),y.value=!1,v.success("密码修改成功")}catch{v.error("密码修改失败，请重试")}finally{x.value=!1}}})},H=()=>{v.info("数据导出功能开发中...")},K=()=>{v.info("隐私设置功能开发中...")},W=async()=>{try{const r=await B.users.getById(b.user.id);p.value=r.data}catch(r){console.error("加载用户数据失败:",r),b.user&&(p.value={...b.user})}};return ue(()=>{b.user&&W()}),(r,e)=>{const k=n("el-avatar"),X=n("Camera"),g=n("el-icon"),_=n("el-button"),F=n("el-tag"),Z=n("Calendar"),C=n("el-card"),ee=n("Lock"),le=n("Download"),te=n("Setting"),c=n("el-col"),oe=n("Edit"),i=n("el-input"),u=n("el-form-item"),q=n("el-row"),S=n("el-form"),ae=n("el-timeline-item"),se=n("el-timeline"),re=n("el-dialog");return P(),M("div",fe,[e[29]||(e[29]=a("div",{class:"profile-header"},[a("h2",{class:"page-title"},"个人资料")],-1)),l(q,{gutter:24},{default:t(()=>[l(c,{lg:8,md:24},{default:t(()=>[l(C,{class:"profile-card"},{default:t(()=>[a("div",_e,[a("div",ce,[l(k,{size:100,src:p.value.avatar_url,class:"profile-avatar"},{default:t(()=>{var o;return[d(f((o=p.value.full_name)==null?void 0:o.charAt(0)),1)]}),_:1},8,["src"]),l(_,{size:"small",class:"avatar-upload",onClick:J},{default:t(()=>[l(g,null,{default:t(()=>[l(X)]),_:1}),e[14]||(e[14]=d(" 更换头像 ",-1))]),_:1})]),a("div",we,[a("h3",ve,f(p.value.full_name),1),a("p",ge,[l(F,{type:Y(p.value.role)},{default:t(()=>[d(f(L(p.value.role)),1)]),_:1},8,["type"])]),a("p",be,[l(g,null,{default:t(()=>[l(Z)]),_:1}),d(" "+f(z(p.value.created_at))+" 加入 ",1)])]),a("div",Ve,[a("div",ye,[a("div",Pe,f(R.activities),1),e[15]||(e[15]=a("div",{class:"stat-label"},"参与活动",-1))]),a("div",ke,[a("div",Ce,f(R.photos),1),e[16]||(e[16]=a("div",{class:"stat-label"},"上传照片",-1))]),a("div",qe,[a("div",Ue,f(R.comments),1),e[17]||(e[17]=a("div",{class:"stat-label"},"发表评论",-1))])])])]),_:1}),l(C,{class:"quick-actions-card"},{header:t(()=>[...e[18]||(e[18]=[a("span",{class:"card-title"},"快捷操作",-1)])]),default:t(()=>[a("div",xe,[l(_,{class:"action-button",onClick:$},{default:t(()=>[l(g,null,{default:t(()=>[l(ee)]),_:1}),e[19]||(e[19]=d(" 修改密码 ",-1))]),_:1}),l(_,{class:"action-button",onClick:H},{default:t(()=>[l(g,null,{default:t(()=>[l(le)]),_:1}),e[20]||(e[20]=d(" 导出数据 ",-1))]),_:1}),l(_,{class:"action-button",onClick:K},{default:t(()=>[l(g,null,{default:t(()=>[l(te)]),_:1}),e[21]||(e[21]=d(" 隐私设置 ",-1))]),_:1})])]),_:1})]),_:1}),l(c,{lg:16,md:24},{default:t(()=>[l(C,{class:"edit-card"},{header:t(()=>[a("div",Ee,[e[25]||(e[25]=a("span",{class:"card-title"},"详细信息",-1)),V.value?(P(),M("div",De,[l(_,{size:"small",onClick:O},{default:t(()=>[...e[23]||(e[23]=[d("取消",-1)])]),_:1}),l(_,{type:"primary",size:"small",loading:U.value,onClick:Q},{default:t(()=>[...e[24]||(e[24]=[d(" 保存 ",-1)])]),_:1},8,["loading"])])):(P(),A(_,{key:0,type:"primary",size:"small",onClick:N},{default:t(()=>[l(g,null,{default:t(()=>[l(oe)]),_:1}),e[22]||(e[22]=d(" 编辑资料 ",-1))]),_:1}))])]),default:t(()=>[l(S,{ref_key:"profileFormRef",ref:E,model:s,rules:I,"label-width":"100px",disabled:!V.value},{default:t(()=>[l(q,{gutter:20},{default:t(()=>[l(c,{span:12},{default:t(()=>[l(u,{label:"真实姓名",prop:"full_name"},{default:t(()=>[l(i,{modelValue:s.full_name,"onUpdate:modelValue":e[0]||(e[0]=o=>s.full_name=o)},null,8,["modelValue"])]),_:1})]),_:1}),l(c,{span:12},{default:t(()=>[l(u,{label:"学号",prop:"student_id"},{default:t(()=>[l(i,{modelValue:s.student_id,"onUpdate:modelValue":e[1]||(e[1]=o=>s.student_id=o)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(u,{label:"邮箱地址",prop:"email"},{default:t(()=>[l(i,{modelValue:s.email,"onUpdate:modelValue":e[2]||(e[2]=o=>s.email=o),disabled:""},null,8,["modelValue"])]),_:1}),l(q,{gutter:20},{default:t(()=>[l(c,{span:12},{default:t(()=>[l(u,{label:"手机号码",prop:"phone"},{default:t(()=>[l(i,{modelValue:s.phone,"onUpdate:modelValue":e[3]||(e[3]=o=>s.phone=o)},null,8,["modelValue"])]),_:1})]),_:1}),l(c,{span:12},{default:t(()=>[l(u,{label:"QQ号码",prop:"qq"},{default:t(()=>[l(i,{modelValue:s.qq,"onUpdate:modelValue":e[4]||(e[4]=o=>s.qq=o)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(q,{gutter:20},{default:t(()=>[l(c,{span:12},{default:t(()=>[l(u,{label:"微信号",prop:"wechat"},{default:t(()=>[l(i,{modelValue:s.wechat,"onUpdate:modelValue":e[5]||(e[5]=o=>s.wechat=o)},null,8,["modelValue"])]),_:1})]),_:1}),l(c,{span:12},{default:t(()=>[l(u,{label:"宿舍号",prop:"dormitory"},{default:t(()=>[l(i,{modelValue:s.dormitory,"onUpdate:modelValue":e[6]||(e[6]=o=>s.dormitory=o)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(u,{label:"家乡地址",prop:"hometown"},{default:t(()=>[l(i,{modelValue:s.hometown,"onUpdate:modelValue":e[7]||(e[7]=o=>s.hometown=o)},null,8,["modelValue"])]),_:1}),l(u,{label:"个人简介",prop:"bio"},{default:t(()=>[l(i,{modelValue:s.bio,"onUpdate:modelValue":e[8]||(e[8]=o=>s.bio=o),type:"textarea",rows:4,placeholder:"介绍一下自己...",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","disabled"])]),_:1}),l(C,{class:"activity-history"},{header:t(()=>[...e[26]||(e[26]=[a("span",{class:"card-title"},"最近活动",-1)])]),default:t(()=>[a("div",Re,[l(se,null,{default:t(()=>[(P(!0),M(me,null,pe(j.value,o=>(P(),A(ae,{key:o.id,timestamp:z(o.created_at),placement:"top"},{default:t(()=>[a("div",he,[a("h4",null,f(o.title),1),a("p",null,f(o.description),1),l(F,{size:"small"},{default:t(()=>[d(f(o.type),1)]),_:2},1024)])]),_:2},1032,["timestamp"]))),128))]),_:1})])]),_:1})]),_:1})]),_:1}),l(re,{modelValue:y.value,"onUpdate:modelValue":e[13]||(e[13]=o=>y.value=o),title:"修改密码",width:"400px","destroy-on-close":""},{footer:t(()=>[a("div",Me,[l(_,{onClick:e[12]||(e[12]=o=>y.value=!1)},{default:t(()=>[...e[27]||(e[27]=[d("取消",-1)])]),_:1}),l(_,{type:"primary",loading:x.value,onClick:G},{default:t(()=>[...e[28]||(e[28]=[d(" 确认修改 ",-1)])]),_:1},8,["loading"])])]),default:t(()=>[l(S,{ref_key:"passwordFormRef",ref:D,model:m,rules:T,"label-width":"80px"},{default:t(()=>[l(u,{label:"当前密码",prop:"currentPassword"},{default:t(()=>[l(i,{modelValue:m.currentPassword,"onUpdate:modelValue":e[9]||(e[9]=o=>m.currentPassword=o),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(u,{label:"新密码",prop:"newPassword"},{default:t(()=>[l(i,{modelValue:m.newPassword,"onUpdate:modelValue":e[10]||(e[10]=o=>m.newPassword=o),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(u,{label:"确认密码",prop:"confirmPassword"},{default:t(()=>[l(i,{modelValue:m.confirmPassword,"onUpdate:modelValue":e[11]||(e[11]=o=>m.confirmPassword=o),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Te=ie(ze,[["__scopeId","data-v-4bbe1a41"]]);export{Te as default};
