import{r as u,l as _e,c as B,h as me,z as V,B as s,R as t,J as o,al as n,Q as pe,a6 as ve,aB as fe,A as g,O as p,P as r,I as ye,E as ge,L as we}from"./vendor-Kw1AtJDw.js";import{a as L}from"./index-BfJ1v8kG.js";import{d as T,E as w,c as be}from"./elementPlus-CHQYLhPp.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-D5g6VmwX.js";const he={class:"activities-view"},ke={class:"header-actions"},Ce={class:"stat-content"},De={class:"stat-info"},Ae={class:"stat-number"},xe={class:"stat-content"},Me={class:"stat-info"},Ye={class:"stat-number"},Ue={class:"stat-content"},Be={class:"stat-info"},Le={class:"stat-number"},Te={class:"activities-container"},Fe={key:0,class:"empty-state"},Se={key:1,class:"activities-grid"},Ee={class:"activity-header"},Re={class:"activity-content"},ze={class:"activity-title"},Ne={class:"activity-description"},Pe={class:"activity-meta"},$e={class:"meta-item"},je={key:0,class:"meta-item"},qe={class:"meta-item"},Ie={class:"activity-actions"},Oe={class:"dialog-footer"},He={__name:"ActivitiesView",setup(Je){const q=fe(),_=u([]),v=u(!1),f=u(null),M=u(!1),Y=u(),F=u(!1),h=u(""),k=u(""),C=u(""),c=_e({title:"",description:"",activity_date:"",location:""}),I={title:[{required:!0,message:"请输入活动标题",trigger:"blur"}],description:[{required:!0,message:"请输入活动描述",trigger:"blur"}],activity_date:[{required:!0,message:"请选择活动时间",trigger:"change"}]},O=B(()=>{const l=new Date;return _.value.filter(e=>new Date(e.activity_date)>l)}),H=B(()=>{const l=new Date;return _.value.filter(e=>new Date(e.activity_date)<=l)}),S=B(()=>{let l=_.value;if(h.value){const e=new Date;l=l.filter(i=>{const d=new Date(i.activity_date);switch(h.value){case"upcoming":return d>e;case"completed":return d<=e;case"ongoing":const m=new Date(d.getTime()+2*60*60*1e3);return d<=e&&e<=m;default:return!0}})}if(k.value){const e=T(k.value).format("YYYY-MM");l=l.filter(i=>T(i.activity_date).format("YYYY-MM")===e)}if(C.value){const e=C.value.toLowerCase();l=l.filter(i=>i.title.toLowerCase().includes(e)||i.description.toLowerCase().includes(e))}return l.sort((e,i)=>new Date(i.activity_date)-new Date(e.activity_date))}),J=l=>T(l).format("YYYY年MM月DD日 HH:mm"),E=l=>{const e=new Date,i=new Date(l.activity_date),d=new Date(i.getTime()+2*60*60*1e3);return i>e?"upcoming":i<=e&&e<=d?"ongoing":"completed"},K=l=>{const e=E(l);return{upcoming:"即将开始",ongoing:"进行中",completed:"已完成"}[e]},Q=()=>{f.value=null,Object.assign(c,{title:"",description:"",activity_date:"",location:""}),v.value=!0},G=async(l,e)=>{switch(l){case"edit":f.value=e,Object.assign(c,{title:e.title,description:e.description,activity_date:e.activity_date,location:e.location}),v.value=!0;break;case"delete":try{await be.confirm("确定要删除这个活动吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const i=_.value.findIndex(d=>d.id===e.id);i>-1&&(_.value.splice(i,1),w.success("活动删除成功"))}catch{}break}},W=async()=>{Y.value&&await Y.value.validate(async l=>{if(l){M.value=!0;try{f.value?(await L.activities.update(f.value.id,c),w.success("活动更新成功")):(await L.activities.create(c),w.success("活动创建成功")),v.value=!1,R()}catch(e){console.error("操作失败:",e),w.error("操作失败，请重试")}finally{M.value=!1}}})},X=l=>{w.info("查看活动详情功能开发中...")},Z=l=>{q.push(`/photos?activity=${l.id}`)},R=async()=>{F.value=!0;try{const l=await L.activities.getAll();_.value=l.data}catch(l){console.error("加载活动数据失败:",l),w.error("加载活动数据失败")}finally{F.value=!1}};return me(()=>{R()}),(l,e)=>{const i=n("Plus"),d=n("el-icon"),m=n("el-button"),z=n("Calendar"),b=n("el-card"),y=n("el-col"),ee=n("Clock"),te=n("Check"),N=n("el-row"),D=n("el-option"),oe=n("el-select"),P=n("el-date-picker"),le=n("Search"),A=n("el-input"),ae=n("el-empty"),se=n("MoreFilled"),$=n("el-dropdown-item"),ne=n("el-dropdown-menu"),ie=n("el-dropdown"),de=n("Location"),ce=n("User"),x=n("el-form-item"),re=n("el-form"),ue=n("el-dialog");return g(),V("div",he,[s("div",ke,[e[10]||(e[10]=s("h2",{class:"page-title"},"班级活动",-1)),t(m,{type:"primary",onClick:Q},{default:o(()=>[t(d,null,{default:o(()=>[t(i)]),_:1}),e[9]||(e[9]=p(" 创建活动 ",-1))]),_:1})]),t(N,{gutter:20,class:"stats-row"},{default:o(()=>[t(y,{span:8},{default:o(()=>[t(b,{class:"stat-card"},{default:o(()=>[s("div",Ce,[t(d,{class:"stat-icon"},{default:o(()=>[t(z)]),_:1}),s("div",De,[s("div",Ae,r(_.value.length),1),e[11]||(e[11]=s("div",{class:"stat-label"},"总活动数",-1))])])]),_:1})]),_:1}),t(y,{span:8},{default:o(()=>[t(b,{class:"stat-card"},{default:o(()=>[s("div",xe,[t(d,{class:"stat-icon upcoming"},{default:o(()=>[t(ee)]),_:1}),s("div",Me,[s("div",Ye,r(O.value.length),1),e[12]||(e[12]=s("div",{class:"stat-label"},"即将开始",-1))])])]),_:1})]),_:1}),t(y,{span:8},{default:o(()=>[t(b,{class:"stat-card"},{default:o(()=>[s("div",Ue,[t(d,{class:"stat-icon completed"},{default:o(()=>[t(te)]),_:1}),s("div",Be,[s("div",Le,r(H.value.length),1),e[13]||(e[13]=s("div",{class:"stat-label"},"已完成",-1))])])]),_:1})]),_:1})]),_:1}),t(b,{class:"filter-card"},{default:o(()=>[t(N,{gutter:16},{default:o(()=>[t(y,{span:6},{default:o(()=>[t(oe,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),placeholder:"活动状态",clearable:""},{default:o(()=>[t(D,{label:"全部",value:""}),t(D,{label:"即将开始",value:"upcoming"}),t(D,{label:"进行中",value:"ongoing"}),t(D,{label:"已完成",value:"completed"})]),_:1},8,["modelValue"])]),_:1}),t(y,{span:6},{default:o(()=>[t(P,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=a=>k.value=a),type:"month",placeholder:"选择月份",clearable:""},null,8,["modelValue"])]),_:1}),t(y,{span:12},{default:o(()=>[t(A,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=a=>C.value=a),placeholder:"搜索活动标题或描述...",clearable:""},{prefix:o(()=>[t(d,null,{default:o(()=>[t(le)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),s("div",Te,[S.value.length===0?(g(),V("div",Fe,[t(ae,{description:"暂无活动"})])):(g(),V("div",Se,[(g(!0),V(pe,null,ve(S.value,a=>(g(),ye(b,{key:a.id,class:"activity-card",shadow:"hover"},{default:o(()=>{var j;return[s("div",Ee,[s("div",{class:ge(["activity-status",E(a)])},r(K(a)),3),t(ie,{onCommand:U=>G(U,a)},{dropdown:o(()=>[t(ne,null,{default:o(()=>[t($,{command:"edit"},{default:o(()=>[...e[14]||(e[14]=[p("编辑",-1)])]),_:1}),t($,{command:"delete",divided:""},{default:o(()=>[...e[15]||(e[15]=[p("删除",-1)])]),_:1})]),_:1})]),default:o(()=>[t(d,{class:"activity-menu"},{default:o(()=>[t(se)]),_:1})]),_:2},1032,["onCommand"])]),s("div",Re,[s("h3",ze,r(a.title),1),s("p",Ne,r(a.description),1),s("div",Pe,[s("div",$e,[t(d,null,{default:o(()=>[t(z)]),_:1}),s("span",null,r(J(a.activity_date)),1)]),a.location?(g(),V("div",je,[t(d,null,{default:o(()=>[t(de)]),_:1}),s("span",null,r(a.location),1)])):we("",!0),s("div",qe,[t(d,null,{default:o(()=>[t(ce)]),_:1}),s("span",null,r((j=a.creator)==null?void 0:j.full_name),1)])]),s("div",Ie,[t(m,{size:"small",onClick:U=>X(a)},{default:o(()=>[...e[16]||(e[16]=[p(" 查看详情 ",-1)])]),_:2},1032,["onClick"]),t(m,{size:"small",type:"primary",onClick:U=>Z(a)},{default:o(()=>[...e[17]||(e[17]=[p(" 查看照片 ",-1)])]),_:2},1032,["onClick"])])])]}),_:2},1024))),128))]))]),t(ue,{modelValue:v.value,"onUpdate:modelValue":e[8]||(e[8]=a=>v.value=a),title:f.value?"编辑活动":"创建活动",width:"600px","destroy-on-close":""},{footer:o(()=>[s("div",Oe,[t(m,{onClick:e[7]||(e[7]=a=>v.value=!1)},{default:o(()=>[...e[18]||(e[18]=[p("取消",-1)])]),_:1}),t(m,{type:"primary",loading:M.value,onClick:W},{default:o(()=>[p(r(f.value?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:o(()=>[t(re,{ref_key:"activityFormRef",ref:Y,model:c,rules:I,"label-width":"80px"},{default:o(()=>[t(x,{label:"活动标题",prop:"title"},{default:o(()=>[t(A,{modelValue:c.title,"onUpdate:modelValue":e[3]||(e[3]=a=>c.title=a),placeholder:"请输入活动标题"},null,8,["modelValue"])]),_:1}),t(x,{label:"活动描述",prop:"description"},{default:o(()=>[t(A,{modelValue:c.description,"onUpdate:modelValue":e[4]||(e[4]=a=>c.description=a),type:"textarea",rows:4,placeholder:"请输入活动描述"},null,8,["modelValue"])]),_:1}),t(x,{label:"活动时间",prop:"activity_date"},{default:o(()=>[t(P,{modelValue:c.activity_date,"onUpdate:modelValue":e[5]||(e[5]=a=>c.activity_date=a),type:"datetime",placeholder:"选择活动时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(x,{label:"活动地点",prop:"location"},{default:o(()=>[t(A,{modelValue:c.location,"onUpdate:modelValue":e[6]||(e[6]=a=>c.location=a),placeholder:"请输入活动地点"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ze=Ve(He,[["__scopeId","data-v-6c2d5fbb"]]);export{Ze as default};
